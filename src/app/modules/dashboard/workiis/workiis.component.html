<div class="flex flex-col gap-2 mt-16 items-start mb-2">
  <div class="flex flex-row justify-between gap-2 items-end w-full">
    <div class="flex flex-row gap-2 flex-grow-[1]">
      <div
        class="h-12 flex flex-grow bg-gray-lighter rounded-md pr-4 items-center"
      >
        <input
          [formControl]="searchControl"
          placeholder="Buscar Workiis"
          #search
          type="text"
          class="flex w-full bg-transparent input-standard ring-0"
        />

        <div class="flex flex-row gap-4 items-center">
          <div>
            <ng-container *ngIf="this.searchControl.value">
              <div
                class="w-8 h-8 bg-error-redLight hover:bg-error-redDark justify-center items-center flex rounded-full cursor-pointer hover-parent-five"
                (click)="clearInput()"
              >
                <svg
                  class="h-4 w-4 hover-child-five"
                  width="16"
                  height="16"
                  viewBox="0 0 16 16"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M15.6456 0.366529C15.5333 0.254025 15.4 0.164768 15.2532 0.103869C15.1064 0.0429689 14.949 0.0116217 14.79 0.0116217C14.6311 0.0116217 14.4737 0.0429689 14.3269 0.103869C14.1801 0.164768 14.0467 0.254025 13.9344 0.366529L8 6.28884L2.06555 0.354393C1.9532 0.242036 1.81981 0.15291 1.67301 0.0921034C1.52621 0.0312965 1.36887 1.18387e-09 1.20997 0C1.05108 -1.18387e-09 0.893737 0.0312965 0.746936 0.0921034C0.600135 0.15291 0.466749 0.242036 0.354393 0.354393C0.242036 0.466749 0.15291 0.600135 0.0921034 0.746936C0.0312965 0.893737 -1.18387e-09 1.05108 0 1.20997C1.18387e-09 1.36887 0.0312965 1.52621 0.0921034 1.67301C0.15291 1.81981 0.242036 1.9532 0.354393 2.06555L6.28884 8L0.354393 13.9344C0.242036 14.0468 0.15291 14.1802 0.0921034 14.327C0.0312965 14.4738 0 14.6311 0 14.79C0 14.9489 0.0312965 15.1063 0.0921034 15.2531C0.15291 15.3999 0.242036 15.5333 0.354393 15.6456C0.466749 15.758 0.600135 15.8471 0.746936 15.9079C0.893737 15.9687 1.05108 16 1.20997 16C1.36887 16 1.52621 15.9687 1.67301 15.9079C1.81981 15.8471 1.9532 15.758 2.06555 15.6456L8 9.71116L13.9344 15.6456C14.0468 15.758 14.1802 15.8471 14.327 15.9079C14.4738 15.9687 14.6311 16 14.79 16C14.9489 16 15.1063 15.9687 15.2531 15.9079C15.3999 15.8471 15.5333 15.758 15.6456 15.6456C15.758 15.5333 15.8471 15.3999 15.9079 15.2531C15.9687 15.1063 16 14.9489 16 14.79C16 14.6311 15.9687 14.4738 15.9079 14.327C15.8471 14.1802 15.758 14.0468 15.6456 13.9344L9.71116 8L15.6456 2.06555C16.1068 1.60439 16.1068 0.827692 15.6456 0.366529V0.366529Z"
                  />
                </svg>
              </div>
            </ng-container>
          </div>
          <img
            class="h-6 w-6"
            src="../../../../../../assets/images/svg/icon-search.svg"
            alt="icon search"
          />
        </div>
      </div>
      <button
        [ngClass]="{ 'bg-success-greenDark': isFilterOpened }"
        (click)="toggleFilter()"
        class="w-12 h-12 btn-solid-blue rounded-md"
      >
        <img
          src="../../../../../../assets/images/svg/icon-filter.svg"
          alt="icon filter"
        />
      </button>
    </div>

    <div class="flex-grow-[1] flex justify-end">
      <button (click)="openModal()" class="btn-solid-blue rounded-md px-4 h-12">
        Crear Workii
      </button>
    </div>
  </div>

  <div
    *ngIf="isFilterOpened"
    class="flex flex-row gap-4 bg-white-principal shadow-md rounded-b-md p-2 w-full animate__animated animate__bounceIn z-10"
  >
    <filter-target></filter-target>
    <filter-time> </filter-time>

    <div class="flex flex-col gap-2 relative hover-parent-three w-[121px]">
      <button-filter-cost
        [checkedInputsCost]="checkedInputsCost"
      ></button-filter-cost>
      <div
        class="hover-child-three flex-col gap-2 p-2 bg-white-principal shadow-md rounded absolute z-10 top-[40px]"
      >
        <ng-container *ngFor="let cost of costs; index as i">
          <label
            [for]="cost"
            class="flex flex-row gap-2 items-center cursor-pointer"
          >
            <input
              type="radio"
              name="costGroup"
              [id]="cost"
              [value]="cost"
              #checkedCost
              (change)="onCostChange(cost, checkedCost.checked)"
              class="rounded outline-0 ring-0 cursor-pointer"
            />
            <p class="title-sm-black">{{ cost }}</p>
          </label>
        </ng-container>
      </div>
    </div>

    <div class="flex flex-col gap-2 relative hover-parent-four w-[130px]">
      <button-filter-ownership
        [checkedInputsStatus]="checkedInputsStatus"
      ></button-filter-ownership>
      <div
        class="hover-child-four flex-col gap-2 p-2 bg-white-principal shadow-md rounded absolute z-10 top-[40px]"
      >
        <ng-container *ngFor="let state of status; index as i">
          <label
            [for]="state"
            class="flex flex-row gap-2 items-center cursor-pointer"
          >
            <input
              type="checkbox"
              name="costGroup"
              [id]="state"
              [value]="state"
              #checkedOwnership
              (change)="onStatusChange(state, checkedOwnership.checked)"
              class="rounded outline-0 ring-0 cursor-pointer"
            />
            <p class="title-sm-black">{{ state }}</p>
          </label>
        </ng-container>
      </div>
    </div>
  </div>
</div>

<div *ngIf="modalSwitch">
  <modal-create-workii></modal-create-workii>
</div>

<div class="flex w-full pb-8">
  <div class="h-[1px] w-full bg-black-principal opacity-20"></div>
</div>

<ng-container
  *ngIf="{
    applications: (applications$ | async) || [],
    searchInApplications:
      (workiisOrSearchInApplications(searchWorkiis$) | async) || [],
    workiisInApplications:
      (workiisOrSearchInApplications(workiis$) | async) || []
  } as context"
>
  <ng-container
    *ngIf="
      context.applications.length ||
      context.searchInApplications.length ||
      context.workiisInApplications.length
    "
  >
    <ng-container *ngIf="loading$ | async">
      <ng-container
        *ngIf="
          this.searchControl.value === null || this.searchControl.value === ''
        "
      >
        <skeleton-cards
          class="col-span-5 grid grid-flow-row 2xl:grid-cols-5 xl:grid-cols-4 lg:grid-cols-3 gap-x-4 gap-y-16 overflow-hidden pt-10 pr-1"
        ></skeleton-cards>
      </ng-container>

      <ng-container
        *ngIf="
          this.searchControl.value !== '' && hasSearched && !(isFound$ | async)
        "
      >
        <search-lottie></search-lottie>
      </ng-container>
    </ng-container>

    <ng-container *ngIf="isFound$ | async">
      <not-found></not-found>
    </ng-container>

    <ng-container *ngIf="!(isFound$ | async) && !(loading$ | async)">
      <workiis-cards
        [workiis]="
          context.workiisInApplications!
            | targetFilter : (targetService.getSelectedTargets$() | async)
            | timeFilter : (timeService.getSelectedTimes$() | async) || []
            | costFilter : (costService.getSelectedCost$() | async) || ''
            | statusFilter
              : (statusService.getSelectedStatus$() | async) || []
              : context.applications
              : userCurrentId
        "
        [searchWorkiis]="
          context.searchInApplications!
            | targetFilter : (targetService.getSelectedTargets$() | async)
            | timeFilter : (timeService.getSelectedTimes$() | async) || []
            | costFilter : (costService.getSelectedCost$() | async) || ''
            | statusFilter
              : (statusService.getSelectedStatus$() | async) || []
              : context.applications
              : userCurrentId
        "
        [applications]="(applications$ | async) || []"
        [userCurrentId]="userCurrentId"
        [isFilterOpened]="isFilterOpened"
        [searchControl]="searchControl"
      ></workiis-cards>
    </ng-container>
  </ng-container>
</ng-container>
